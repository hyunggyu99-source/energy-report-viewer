# Energy 3D Viewer — 개발 과정 설명서

**누구나 이해할 수 있는 쉬운 설명서**

---

## 이 프로그램이 뭐야?

건물의 에너지를 분석하는 **3D 뷰어**입니다.

쉽게 말하면:
- 건물의 3D 모델을 웹 브라우저에서 볼 수 있고
- 각 방(Space)이 에너지를 얼마나 쓰는지 색깔로 보여주고
- 난방, 냉방, 조명 등의 에너지 사용량을 그래프로 보여주는 프로그램

> **비유**: 건물의 "에너지 X-ray 사진"을 3D로 보는 것과 같습니다.

---

## 어떤 파일이 필요해?

| 파일 | 설명 | 비유 |
|------|------|------|
| `model.glb` | 건물 3D 모델 파일 | 건물의 외형 사진 |
| `energy-spaces.json` | 각 방의 위치/크기 데이터 | 건물의 방 배치도 |
| `eplustbl.htm` | 에너지 시뮬레이션 결과 | 건물의 에너지 성적표 |

---

## 개발 과정 — 무엇을 만들었나?

### 1단계: 기본 구조 (처음 만든 것)

회사 개발자(jihyunan-dev)가 `index.html`로 **2D 에너지 분석 대시보드**를 먼저 만들었습니다.
- HTM 보고서를 드래그하면 차트와 표로 에너지 데이터를 보여주는 웹 페이지
- 월별 에너지 사용량, 존(Zone)별 비교 등을 할 수 있음

### 2단계: 3D 뷰어 추가 (`energy-3d-viewer.html`)

2D만으로는 건물의 어디에 어떤 방이 있는지 직관적으로 보기 어려워서, **3D 뷰어**를 새로 만들었습니다.

#### 핵심 기능들:

**A. 3D 건물 표시**
```
파일 로드 → 3D 박스로 각 방 표시 → 마우스로 회전/확대 가능
```
- GLB 파일(3D 모델)을 드래그하면 건물이 화면에 뜸
- 각 방은 반투명 박스로 표시됨
- 마우스로 돌려보고 확대/축소 가능

**B. 에너지 히트맵**
```
에너지 많이 쓰는 방 = 빨간색, 적게 쓰는 방 = 파란색
```
- HTM 보고서를 넣으면 각 방이 에너지 사용량에 따라 색이 변함
- 온도 지도처럼 한눈에 어디가 에너지를 많이 쓰는지 보임

**C. 해석 표면 (Analytical Surfaces)**
```
벽, 바닥, 지붕, 창문 = 각각 다른 색으로 표시
```
- JSON에 해석 표면 데이터가 포함되면 열해석 경계면도 표시
- 외벽은 파란색, 지붕은 빨간색, 창문은 하늘색 등

### 3단계: UI/UX 개선 (최근 수정 사항)

#### 수정 1: HTM 로드 시 자동 패널 정리
- **문제**: 에너지 보고서를 넣으면 그래프가 안 보였음 (접었다 펴야 보임)
- **해결**: HTM 파일 넣으면 자동으로:
  - "Energy Report" 섹션이 접히고
  - "에너지 분석 요약" 섹션이 펼쳐지고
  - 차트가 바로 정상 크기로 표시됨

> **비유**: 책을 펴면 자동으로 목차 페이지가 열리는 것처럼

#### 수정 2: Space 선택 시 3D 하이라이트
- **문제**: Space 목록에서 방을 선택해도 3D에서 어디인지 찾기 어려움
- **해결**: 방을 선택하면:
  - 선택한 방 = 밝게 + 금색 테두리
  - 나머지 방 = 거의 투명하게
  - 카메라가 선택한 방 쪽으로 이동
  - 빈 곳 클릭하면 원래대로 복원

> **비유**: 무대에서 주인공에게만 스포트라이트 비추는 것

#### 수정 3: SI/IP 단위 통합
- **문제**: 위쪽 IP/SI 버튼과 설정의 "치수 단위" 드롭다운이 따로 놀았음
- **해결**: IP/SI 버튼 하나로 모든 단위가 한번에 바뀜
  - **IP 모드**: ft, ft², ft³, kBtu, Btu/h (미국식)
  - **SI 모드**: m, m², m³, kWh, W (국제 표준)

> **비유**: 번역기의 "한국어/영어" 버튼 하나로 모든 텍스트가 바뀌는 것

#### 수정 4: Space 박스 크기 제한
- **문제**: 일부 방의 3D 박스가 건물 밖으로 삐져나옴
- **해결**: 건물 모델(GLB)의 경계를 기준으로 박스 크기를 자동 제한

> **비유**: 색칠공부에서 선 밖으로 나가지 않게 하는 것

#### 수정 5: 특성창 드롭다운 개선
- **문제**: 속성 패널의 드롭다운이 "Spaces (1)"만 뜨고 동작 안 함
- **해결**: 선택한 Space의 이름 + 관련 해석 표면 목록이 드롭다운에 표시되어 바로 전환 가능

---

## 프로그램의 전체 흐름

```
사용자가 파일을 드래그
        ↓
┌─────────────────────────────────────┐
│  1. GLB 파일  → 건물 3D 모델 표시    │
│  2. JSON 파일 → 방 박스 + 라벨 생성   │
│  3. HTM 파일  → 에너지 데이터 연결    │
└─────────────────────────────────────┘
        ↓
   데이터 매칭 (방 이름 ↔ Zone 이름)
        ↓
┌─────────────────────────────────────┐
│  화면 표시:                          │
│  - 왼쪽: 설정 + Space 목록           │
│  - 가운데: 3D 뷰포트                 │
│  - 오른쪽: 선택한 방의 상세 정보       │
└─────────────────────────────────────┘
```

---

## 사용된 기술 — 쉬운 설명

| 기술 | 뭐하는 건지 | 비유 |
|------|------------|------|
| HTML | 웹 페이지의 뼈대 | 건물의 골조 |
| CSS | 웹 페이지의 디자인 | 건물의 인테리어 |
| JavaScript | 웹 페이지의 동작 | 건물의 전기/기계 시스템 |
| Three.js | 3D 그래픽 라이브러리 | 3D 카메라 + 조명 장비 |
| Chart.js | 차트/그래프 라이브러리 | 엑셀의 차트 기능 |
| GLTFLoader | 3D 모델 파일 읽기 | 사진 뷰어가 사진을 여는 것 |
| OrbitControls | 마우스로 3D 회전/확대 | 구글 지도의 드래그/줌 기능 |

---

## 파일 구조 (모듈화 후)

```
연간분석/
├── energy-3d-viewer.html   ← 3D 에너지 뷰어 (메인 HTML + 앱 로직)
├── css/
│   └── viewer.css          ← 스타일시트 (모든 CSS를 분리)
├── js/
│   ├── config.js           ← 설정, 상수, 언어 사전, 단위 변환 함수
│   └── parser.js           ← HTM 보고서 파서 (순수 함수, 독립 모듈)
├── index.html              ← 원래 2D 에너지 분석 대시보드
├── DEVELOPMENT-GUIDE.md    ← 이 파일 (누구나 읽는 설명서)
├── CODE-REFERENCE.md       ← 코드 구조 설명 (한글 주석)
├── README.md               ← 프로젝트 소개 (개발자용)
├── LICENSE                 ← 라이선스 (MIT)
└── .git/                   ← Git 버전 관리 폴더
```

### HTML 내부의 섹션 구조 (18개 섹션)

| 섹션 | 이름 | 설명 |
|------|------|------|
| 1 | 전역 상태 변수 | 앱의 핵심 데이터 |
| 2 | Three.js 엔진 초기화 | 3D 장면, 카메라, 조명 설정 |
| 3 | 파일 드래그/클릭 설정 | 드래그 앤 드롭 처리 |
| 4 | GLB 3D 모델 로드 | Revit GLB 파일 처리 |
| 5 | JSON Space 데이터 로드 | Space 정보 파싱 |
| 6 | HTM 에너지 보고서 로드 | EnergyPlus 보고서 처리 |
| 7 | Space 3D 박스 생성 | BBox 데이터로 3D 박스 생성 |
| 8 | 해석 표면 생성 | 벽/바닥/지붕 경계면 생성 |
| 9 | 색상 시스템 | 히트맵 + 카테고리 색상 |
| 10 | Space 목록 & 선택 | 사이드바 목록과 클릭 이벤트 |
| 11 | 속성 패널 | Revit 스타일 속성 표시 |
| 12 | 마우스 상호작용 | 호버 툴팁, 클릭 선택 |
| 13 | 모델 표시 제어 | 투명/불투명/와이어 전환 |
| 14 | 도구 모음 버튼 | 뷰포트 상단 토글 버튼 |
| 15 | 설정 컨트롤 | 색상, 투명도, 필터 |
| 16 | 단위/언어 토글 | SI↔IP, 한↔영 전환 |
| 17 | 접기/펼치기 패널 | 사이드바 패널 관리 |
| 18 | 초기화 | 앱 시작, 이벤트 바인딩 |

---

## 회사 개발자의 코드 정리 방식

회사 개발자(jihyunan-dev)가 올린 코드를 보면 이런 패턴을 따릅니다:

### 1. README.md (프로젝트 설명서)
- 프로젝트가 뭔지 한줄 설명
- 주요 기능 목록
- 사용 방법
- 기술 스택
- 한국어/영어 병행

### 2. Git 커밋 메시지
```
Initial release: Annual Building Systems Analysis web dashboard
```
- 영어로, 무엇을 했는지 명확하게 작성

### 3. 코드 내부 구조
- `// ========` 구분선으로 섹션 구분
- 관련 기능끼리 모아놓음 (파일 로드, 3D 렌더링, UI 등)
- 변수명을 의미있게 지음 (`spaceMeshes`, `htmReports` 등)

---

## 전문 개발자들이 코드를 정리하는 일반적인 방법

### 파일 구조
```
프로젝트/
├── README.md           ← 프로젝트 설명 (필수)
├── LICENSE             ← 라이선스
├── .gitignore          ← Git에서 무시할 파일 목록
├── package.json        ← 프로젝트 설정 + 의존성 (Node.js)
├── src/                ← 소스 코드 폴더
│   ├── index.js        ← 메인 진입점
│   ├── components/     ← UI 컴포넌트
│   ├── utils/          ← 유틸리티 함수
│   └── styles/         ← CSS 파일
├── public/             ← 정적 파일 (이미지, 폰트 등)
├── tests/              ← 테스트 코드
└── docs/               ← 문서
```

### 코드 정리 원칙

| 원칙 | 설명 | 예시 |
|------|------|------|
| **관심사 분리** | 기능별로 파일 나누기 | HTML/CSS/JS 분리 |
| **의미있는 이름** | 변수/함수 이름만 보고 알 수 있게 | `selectSpace()` ← 공간을 선택한다 |
| **주석 달기** | 복잡한 부분에 설명 추가 | `// Revit Z-up → Three.js Y-up` |
| **섹션 구분** | 코드를 논리적 블록으로 나누기 | `// ====== STATE ======` |
| **DRY** | 같은 코드 반복하지 않기 | 공통 함수로 묶기 |
| **버전 관리** | Git으로 변경 이력 추적 | 커밋 메시지로 뭘 바꿨는지 기록 |

### 우리 프로젝트의 모듈화 접근

이 프로젝트는 **전문 개발자 방식으로 모듈화**되었습니다:

1. **CSS 분리** (`css/viewer.css`)
   - 스타일과 구조를 분리 — 디자인만 수정할 때 CSS 파일만 편집
   - HTML 안에도 인라인 CSS를 유지 → 서버 없이도 작동 (폴백)

2. **설정/상수 분리** (`js/config.js`)
   - 언어 사전(한국어/영어), 단위 변환 함수, 색상 팔레트를 한 곳에서 관리
   - 새 언어 추가? → config.js의 LANG 객체에 추가하면 됨
   - 단위 변환 수정? → config.js의 U() 함수만 수정

3. **HTM 파서 분리** (`js/parser.js`)
   - EnergyPlus 보고서 파싱 로직을 독립 모듈로 분리
   - 다른 프로젝트에서도 재사용 가능 (순수 함수)

4. **메인 앱** (`energy-3d-viewer.html`)
   - 18개 한국어 섹션으로 정리
   - 각 섹션의 역할이 명확 → 특정 기능만 수정 가능
   - ES Module import로 외부 모듈과 연결

> **참고**: ES Module을 사용하므로 로컬 서버가 필요합니다.
> `npx serve` 또는 `python -m http.server` 명령으로 실행하세요.

---

## 자주 묻는 질문

**Q: 인터넷 없이도 되나요?**
A: 처음 로드할 때 Three.js와 Chart.js를 인터넷에서 가져오므로, 첫 실행 시 인터넷이 필요합니다. (CDN 방식)

**Q: 파일이 서버로 전송되나요?**
A: 아니요! 모든 처리가 여러분의 컴퓨터(브라우저)에서만 이루어집니다. 데이터가 외부로 나가지 않습니다.

**Q: 어떤 브라우저에서 되나요?**
A: Chrome, Edge, Firefox 등 최신 브라우저에서 동작합니다. (WebGL 지원 필요)

---

*이 문서는 Energy 3D Viewer 프로젝트의 개발 과정을 설명하기 위해 작성되었습니다.*
*마지막 업데이트: 2026-02-12*
